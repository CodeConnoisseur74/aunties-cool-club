{% extends 'base.html' %}

{% block content %}
  <div class="flex flex-col h-screen">
    <!-- Messages Section -->
    <div class="flex-grow overflow-y-auto p-4" id="messages" hx-get="{% url 'load_messages' chat_room.id %}" hx-trigger="load" hx-swap="innerHTML">
      <!-- Fallback for non-HTMX users -->
      {% for message in messages %}
        {% include 'chat/_message.html' with message=message %}
      {% endfor %}
    </div>

    <!-- Message Form -->
    <div class="p-4">
      <form hx-post="{% url 'send_message' chat_room.id %}" hx-target="#messages" hx-swap="beforeend" hx-on="htmx:afterRequest: this.reset()" method="post">
        {% csrf_token %}
        <textarea name="text" class="w-full p-2 border rounded" placeholder="Type your message..." required></textarea>
        <select name="message_type" class="mt-2 p-2 border rounded">
          <option value="message">Message</option>
          <option value="post">Post</option>
          <option value="lesson">Lesson</option>
        </select>
        <button type="submit" class="mt-2 p-2 bg-blue-500 text-white rounded">Send</button>
      </form>
    </div>
  </div>
{% endblock %}
